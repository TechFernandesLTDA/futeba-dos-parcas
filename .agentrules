# Agent Rules - Regras para AI Agents (Gemini, Claude, etc.)

## ğŸ¯ PropÃ³sito

Este arquivo define regras universais para qualquer AI agent trabalhando neste projeto.

## ğŸ”¥ ACESSO AO FIREBASE

**CRÃTICO**: Todos os AI agents tÃªm acesso COMPLETO ao Firebase via Service Account.

### âœ… Capacidades DisponÃ­veis

```yaml
firestore:
  leitura: "âœ… COMPLETO - Todas as collections"
  escrita: "âœ… COMPLETO - Criar/atualizar documentos"
  deleÃ§Ã£o: "âœ… COMPLETO - Deletar dados"
  queries: "âœ… COMPLETO - Queries complexas"

firebase_auth:
  listar: "âœ… Todos os usuÃ¡rios"
  criar: "âœ… Novos usuÃ¡rios"
  gerenciar: "âœ… Contas e permissÃµes"

firebase_storage:
  listar: "âœ… Arquivos e pastas"
  upload: "âœ… Imagens e arquivos"
  deletar: "âœ… Remover arquivos"

firebase_functions:
  deploy: "âœ… Novas functions"
  executar: "âœ… Chamar functions"
  logs: "âœ… Ver logs"

credenciais:
  arquivo: "futebadosparcas-firebase-adminsdk-fbsvc-b5fb25775d.json"
  projeto: "futebadosparcas"
  permissÃµes: "FULL ADMIN ACCESS"
```

### âš ï¸ Diretrizes de Uso

```yaml
use_firebase_direto:
  - "Analisar estrutura de dados"
  - "Verificar dados antes de implementar"
  - "Debugar problemas de dados"
  - "Validar queries complexas"
  - "Criar dados de teste"

SEMPRE_confirme_antes:
  - "âŒ DELETAR dados em produÃ§Ã£o"
  - "âŒ Modificar dados de usuÃ¡rios reais"
  - "âŒ Alterar estrutura de collections"
  - "âŒ OperaÃ§Ãµes em massa"

prefira_app_android:
  - "Criar dados mock (Developer Menu)"
  - "Resetar base (Developer Menu)"
  - "Testar fluxos completos"
```

---

## ğŸŒ Idioma ObrigatÃ³rio

```yaml
comentÃ¡rios: portuguÃªs (PT-BR)
strings_ui: portuguÃªs (PT-BR)
cÃ³digo: english
documentaÃ§Ã£o: portuguÃªs (PT-BR)
commits: portuguÃªs (PT-BR)
```

## ğŸ“ PadrÃµes de CÃ³digo

### Arquitetura ObrigatÃ³ria

```
MVVM + Clean Architecture + Hilt DI

UI Layer:
  - Fragment/Activity (ViewBinding ou Compose)
  - Observa StateFlow do ViewModel
  - NUNCA lÃ³gica de negÃ³cio na UI

ViewModel Layer:
  - @HiltViewModel
  - StateFlow<UiState> (sealed classes)
  - viewModelScope para coroutines
  - NUNCA referÃªncias a Context/Activity/Fragment

Repository Layer:
  - Interface + ImplementaÃ§Ã£o
  - Result<T> para operaÃ§Ãµes que podem falhar
  - Flow<T> para dados em tempo real
  - suspend fun para operaÃ§Ãµes Ãºnicas

Data Source:
  - Firebase (Firestore, Auth, Storage, FCM)
  - Room (cache local)
```

### Null Safety

```kotlin
# PERMITIDO
?.let { }
?.run { }
?: defaultValue
if (x != null) { }

# PROIBIDO
!! operator (exceto em casos 100% seguros como binding)
```

### Coroutines

```kotlin
# ViewModel
viewModelScope.launch { }

# Fragment
viewLifecycleOwner.lifecycleScope.launch { }

# Repository (jÃ¡ Ã© suspend)
suspend fun getData(): Result<Data>
```

### StateFlow Pattern

```kotlin
# SEMPRE use este padrÃ£o:

sealed class MyUiState {
    object Loading : MyUiState()
    data class Success(val data: Data) : MyUiState()
    data class Error(val message: String) : MyUiState()
}

private val _uiState = MutableStateFlow<MyUiState>(MyUiState.Loading)
val uiState: StateFlow<MyUiState> = _uiState.asStateFlow()
```

## ğŸ”§ Regras de EdiÃ§Ã£o de Arquivos

### CRÃTICO - EstratÃ©gia de EdiÃ§Ã£o

```yaml
arquivos_xml:
  estratÃ©gia: REWRITE COMPLETO
  razÃ£o: "IndentaÃ§Ã£o complexa causa falhas em patches"

arquivos_kotlin_grandes:
  estratÃ©gia: REWRITE COMPLETO
  limite: "> 200 linhas"

arquivos_kotlin_pequenos:
  estratÃ©gia: "EDIT pontual OK"
  limite: "< 200 linhas"

regra_de_ouro: |
  Se EDIT falhar 2 vezes, use WRITE para reescrever o arquivo completo
```

### Naming Conventions

```yaml
activities: "LoginActivity.kt"
fragments: "GamesFragment.kt"
viewmodels: "GamesViewModel.kt"
repositories: "GameRepository.kt" (interface)
              "GameRepositoryImpl.kt" (implementaÃ§Ã£o)
adapters: "GamesAdapter.kt"
models: "Game.kt", "User.kt"
enums: "GameStatus.kt", "UserRole.kt"

layouts:
  activities: "activity_login.xml"
  fragments: "fragment_games.xml"
  items: "item_game.xml"
  dialogs: "dialog_select_position.xml"
```

## ğŸ”¥ Firebase Rules

### Collections Schema

```yaml
users:
  campos_obrigatÃ³rios: [id, name, email, role]
  roles: [Player, FieldOwner, Admin]

games:
  campos_obrigatÃ³rios: [id, locationId, dateTime, status, maxPlayers]
  status: [SCHEDULED, CONFIRMED, LIVE, FINISHED, CANCELLED]
  subcollections: [confirmations]

confirmations:
  campos_obrigatÃ³rios: [userId, userName, position, confirmedAt]
  position: [GOALKEEPER, LINE_PLAYER]

locations:
  campos_obrigatÃ³rios: [id, name, address, latitude, longitude]
  subcollections: [fields]

fields:
  campos_obrigatÃ³rios: [id, name, type, locationId]
  types: [SOCIETY, FUTSAL, FIELD, BEACH, SYNTHETIC_GRASS]

statistics:
  campos_obrigatÃ³rios: [userId, totalGames, wins, goals, assists]

live_games:
  campos_obrigatÃ³rios: [id, gameId, type, playerId, teamNumber, timestamp]
  types: [GOAL, YELLOW_CARD, RED_CARD, SUBSTITUTION]
```

### Regras de SeguranÃ§a

```yaml
autenticaÃ§Ã£o: OBRIGATÃ“RIA (exceto para mocks com isMock: true)

permissÃµes:
  leitura: "Autenticado"
  escrita_user: "PrÃ³prio usuÃ¡rio ou Admin"
  escrita_game: "Criador do jogo ou Admin"
  escrita_admin: "Apenas Admin"

validaÃ§Ãµes:
  roles: "Validar enums no Firestore rules"
  status: "Validar transiÃ§Ãµes de estado"
  campos_obrigatÃ³rios: "Validar presenÃ§a"
```

## ğŸ“¦ Hilt Dependency Injection

### Modules Existentes

```yaml
AppModule:
  provides: [Repositories, UseCases]

FirebaseModule:
  provides: [FirebaseAuth, FirebaseFirestore, FirebaseStorage, FirebaseFunctions]

DatabaseModule:
  provides: [Room Database, DAOs]
```

### AnotaÃ§Ãµes ObrigatÃ³rias

```kotlin
# ViewModel
@HiltViewModel
class MyViewModel @Inject constructor()

# Fragment/Activity
@AndroidEntryPoint
class MyFragment : Fragment()

# Repository no Module
@Provides
@Singleton
fun provideRepository(): Repository = RepositoryImpl()
```

## ğŸ¨ Design System

```yaml
cores_primÃ¡rias:
  primary: "#58CC02"  # Verde Duolingo
  accent: "#FF9600"   # Laranja

cores_estado:
  success: "#58CC02"
  error: "#D32F2F"
  warning: "#FFA000"
  info: "#1976D2"

tipografia:
  fonte_principal: "Roboto"
  tamanhos: [12sp, 14sp, 16sp, 18sp, 24sp, 32sp]

espaÃ§amento:
  unidade_base: 8dp
  valores: [4dp, 8dp, 16dp, 24dp, 32dp]

componentes:
  estilo: "Material Design 3"
  tema: "Gamificado (estilo Duolingo)"
```

## ğŸš« ProibiÃ§Ãµes Absolutas

```yaml
proibido:
  - "findViewById() - Use ViewBinding"
  - "LiveData - Use StateFlow"
  - "!! operator (exceto binding)"
  - "InjeÃ§Ã£o manual de dependÃªncias - Use Hilt"
  - "LÃ³gica de negÃ³cio na UI"
  - "Hardcoded strings - Use strings.xml"
  - "Magic numbers - Use constants"
  - "God classes (> 500 linhas)"
  - "Nested callbacks - Use coroutines"
  - "Mutable collections expostas - Use toList()/toMap()"
```

## âœ… ObrigaÃ§Ãµes

```yaml
obrigatÃ³rio:
  - "ViewBinding ou Compose para UI"
  - "StateFlow para estado de UI"
  - "Hilt para DI"
  - "Coroutines para async"
  - "Result<T> para operaÃ§Ãµes que podem falhar"
  - "Flow<T> para dados em tempo real"
  - "Sealed classes para UI states"
  - "ComentÃ¡rios em portuguÃªs"
  - "Try-catch em operaÃ§Ãµes de rede/disco"
  - "Limpar binding em onDestroyView"
```

## ğŸ“Š Status do Projeto (ReferÃªncia RÃ¡pida)

```yaml
features_completas:
  autenticaÃ§Ã£o: 100%
  jogos: 95%
  locais: 90%
  estatÃ­sticas: 85%
  jogo_ao_vivo: 80%

features_parciais:
  gamificaÃ§Ã£o: 30%  # PRIORIDADE - Falta ViewModels
  pagamentos: 10%
  experiÃªncia_jogo: 15%

features_nÃ£o_iniciadas:
  schedules_recorrentes: 0%
  networking_convites: 0%
  backend_nodejs: 5%
```

## ğŸ¯ Prioridades de Desenvolvimento

```yaml
1_urgente:
  - "Completar gamificaÃ§Ã£o (LeagueViewModel, BadgesViewModel)"
  - "Auto-award de badges apÃ³s jogos"

2_importante:
  - "EdiÃ§Ã£o e cancelamento de jogos"
  - "NotificaÃ§Ãµes FCM para confirmaÃ§Ãµes"

3_desejÃ¡vel:
  - "Sistema de pagamentos PIX"
  - "VotaÃ§Ã£o MVP"
  - "Cards instagramÃ¡veis"
```

## ğŸ“ Estrutura de Arquivos

```yaml
models: "data/model/*.kt"
repositories: "data/repository/*Repository*.kt"
viewmodels: "ui/[feature]/*ViewModel.kt"
fragments: "ui/[feature]/*Fragment.kt"
activities: "ui/[feature]/*Activity.kt"
adapters: "ui/[feature]/*Adapter.kt"
layouts: "res/layout/*.xml"
drawables: "res/drawable/*.xml"
strings: "res/values/strings.xml"
colors: "res/values/colors.xml"
```

## ğŸ” DocumentaÃ§Ã£o de ReferÃªncia

```yaml
contexto_geral: ".agent/QUICK_REFERENCE.md"
estado_projeto: ".agent/PROJECT_STATE.md"
padrÃµes_firebase: ".agent/FIREBASE_MODERNIZATION.md"
features_pendentes: "IMPLEMENTACAO.md"
setup_projeto: "README.md"

instruÃ§Ãµes_claude: "CLAUDE.md"
instruÃ§Ãµes_gemini: "GEMINI.md"
contexto_gemini: ".agent/GEMINI_CONTEXT.md"
```

## ğŸ§ª Testing

```yaml
testes_unitÃ¡rios:
  pasta: "test/"
  framework: "JUnit 4"
  mocking: "Mockito"

testes_instrumentados:
  pasta: "androidTest/"
  framework: "Espresso"

convenÃ§Ã£o:
  nome: "[ClasseTestada]Test.kt"
  exemplo: "GameRepositoryImplTest.kt"
```

## ğŸš€ Release Protocol (CRÃTICO)

Sempre que o usuÃ¡rio mencionar "publicar", "release", "loja", "play store", "produÃ§Ã£o" ou "nova versÃ£o":

1. **Verificar `app/build.gradle.kts`**:
   - `versionCode`: Incrementar (+1) obrigatÃ³rio
   - `versionName`: Semantic Versioning (Major.Minor.Patch)

2. **AÃ§Ã£o ObrigatÃ³ria**:
   - Atualizar `versionCode` e `versionName` antes de qualquer build de release.
   - Perguntar: "Confirmar versÃ£o X (build Y)?" se houver dÃºvida.

3. **NUNCA gerar APK/AAB de release com versÃ£o repetida.**

## ğŸš€ Build & Deploy

```bash
# Build debug
./gradlew assembleDebug

# Build release
./gradlew assembleRelease

# Instalar no device
./gradlew installDebug

# Testes
./gradlew test

# Clean
./gradlew clean
```

## ğŸ“ Commits

```yaml
formato: "tipo(escopo): mensagem em portuguÃªs"

tipos:
  - feat: "Nova feature"
  - fix: "CorreÃ§Ã£o de bug"
  - refactor: "RefatoraÃ§Ã£o"
  - style: "FormataÃ§Ã£o, lint"
  - docs: "DocumentaÃ§Ã£o"
  - test: "Testes"
  - chore: "ManutenÃ§Ã£o"

exemplos:
  - "feat(games): adicionar filtro de jogos abertos"
  - "fix(auth): corrigir validaÃ§Ã£o de email"
  - "refactor(statistics): simplificar cÃ¡lculo de mÃ©dia"
```

## ğŸ”’ SeguranÃ§a

```yaml
nunca_commitar:
  - google-services.json (usar .gitignore)
  - serviceAccountKey.json
  - .env
  - *.keystore
  - *.jks
  - Senhas ou tokens

sempre_validar:
  - Input do usuÃ¡rio
  - Dados de APIs externas
  - PermissÃµes de roles
  - TransiÃ§Ãµes de estado
```

## ğŸ“ˆ Performance

```yaml
otimizaÃ§Ãµes:
  - "Usar LazyColumn/LazyRow no Compose"
  - "Usar RecyclerView com DiffUtil"
  - "Paginar listas grandes"
  - "Cache com Room para offline"
  - "Ãndices compostos no Firestore"
  - "Limitar queries Firestore"

evitar:
  - "OperaÃ§Ãµes pesadas na UI thread"
  - "Queries N+1"
  - "Carregar todas as imagens de uma vez"
  - "Nested RecyclerViews"
```

## ğŸ§  OrquestraÃ§Ã£o de Super-Modelos (Antigravity Hub - "The A-Team")

O agente principal (Gemini 3/Antigravity) atua como **LÃDER E ORQUESTRADOR**.
VocÃª deve delegar tarefas especializadas para os workers corretos usando `run_command`:

### 1. ğŸ¨ Especialista em UI/UX & Refino Visual

- **Modelos**: Claude Code (Sonnet 4.6 / Opus)
- **Comando**: `claude -p "instruÃ§Ã£o"` (Modo Direto)
- **Quando usar**:
  - CriaÃ§Ã£o e correÃ§Ã£o de Layouts XML (XML Perfect)
  - SugestÃµes de Design System e Cores
  - Micro-interaÃ§Ãµes e AnimaÃ§Ãµes
  - Bugs especÃ­ficos de Android View system

### 2. ğŸ—ï¸ Heavy Lifter (CodificaÃ§Ã£o Pesada)

- **Modelo**: **Qwen3-Coder (480b Cloud)**
- **Comando**: `ollama run qwen3-coder:480b-cloud "instruÃ§Ã£o"`
- **Quando usar**:
  - RefatoraÃ§Ã£o massiva de cÃ³digo
  - CriaÃ§Ã£o de mÃ³dulos inteiros (Controller + Service + Repo)
  - Escrita de testes unitÃ¡rios extensivos

### 3. ğŸ§  EstratÃ©gia & RaciocÃ­nio Profundo

- **Modelo**: **DeepSeek V3.1 (671b Cloud)**
- **Comando**: `ollama run deepseek-v3.1:671b-cloud "instruÃ§Ã£o"`
- **Quando usar**:
  - DefiniÃ§Ã£o de Arquitetura e Design Patterns
  - LÃ³gica de algoritmos complexos (ex: Team Balancing)
  - Debugging de Race Conditions ou vazamento de memÃ³ria

### 4. ğŸ“š Contexto Infinito & AnÃ¡lise

- **Modelo**: **GLM-4.7 (198K Context)**
- **Comando**: `ollama run glm-4.7:cloud "instruÃ§Ã£o"`
- **Quando usar**:
  - Leitura de mÃºltiplos arquivos gigantes
  - Entender todo o histÃ³rico do projeto
  - Gerar documentaÃ§Ã£o abrangente baseada em todo o codebase

### 5. ğŸ”¥ Backend Ops & Data God

- **Ferramentas**: Firebase CLI & Admin SDK (Integrado no Agente)
- **Quando usar**:
  - ManipulaÃ§Ã£o direta de Firestore (criaÃ§Ã£o de seeds, resets)
  - Deploy de Cloud Functions, Rules e Indexes
  - GestÃ£o de Auth e UsuÃ¡rios

---

### Guia de DecisÃ£o RÃ¡pida

| Tarefa | Delegar Para |
| :--- | :--- |
| "Melhorar a tela X" | **Claude** |
| "Refatorar RepositoryImpl" | **Qwen3-Coder** |
| "Planejar Feature de Torneio" | **DeepSeek V3.1** |
| "Resumir o projeto todo" | **GLM-4.7** |
| "Criar usuÃ¡rio Admin" | **Firebase Admin** |

### ğŸ–¥ï¸ IntegraÃ§Ã£o com Claude CLI (Modo Direto)

**InstruÃ§Ã£o Especial:** Para tarefas de **UI/UX, Design de Interface e Layouts XML**, priorize o uso da ferramenta `claude` no terminal (Modo Direto).

1. **Comando**: Utilize `run_command` com `claude -p "Sua instruÃ§Ã£o detalhada aqui"`
2. **Por que?**: O Claude possui calibraÃ§Ã£o superior para design visual e geraÃ§Ã£o de layouts XML sem erros.
3. **Fluxo**:
   - Analise o pedido do usuÃ¡rio.
   - Se for UI/Design -> Execute `claude -p "..."`.
   - Leia a resposta e aplique ao projeto (ou apresente ao usuÃ¡rio).

### Workflow Recomendado

```
1. DecisÃ£o Arquitetural (Opus 4.6)
   â†“
2. ImplementaÃ§Ã£o (Sonnet 4.6)
   â†“
3. ValidaÃ§Ã£o Visual (Gemini 3 Pro)
   â†“
4. CorreÃ§Ãµes (Gemini 3 Flash ou Sonnet)
```

**Ver detalhes**: `.agent/MODEL_SELECTION.md`

---

## ğŸ“ Boas PrÃ¡ticas Finais

1. **Leia cÃ³digo existente antes de criar novo**
2. **Siga os padrÃµes do projeto religiosamente**
3. **Use os arquivos de referÃªncia** (.agent/QUICK_REFERENCE.md)
4. **Escolha o modelo correto** (.agent/MODEL_SELECTION.md)
5. **Pergunte antes de fazer mudanÃ§as arquiteturais**
6. **Teste localmente antes de commitar**
7. **Documente decisÃµes importantes**
8. **Mantenha simplicidade** (KISS principle)
9. **NÃ£o reinvente a roda** (use bibliotecas consolidadas)
10. **Escale para Opus quando necessÃ¡rio** (decisÃµes crÃ­ticas)

---

**Ãšltima atualizaÃ§Ã£o**: 27/12/2024
**VersÃ£o**: 2.0 (Multi-Model Support)
