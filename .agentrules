# Agent Rules - Regras para AI Agents (Gemini, Claude, etc.)

## üéØ Prop√≥sito
Este arquivo define regras universais para qualquer AI agent trabalhando neste projeto.

## üî• ACESSO AO FIREBASE

**CR√çTICO**: Todos os AI agents t√™m acesso COMPLETO ao Firebase via Service Account.

### ‚úÖ Capacidades Dispon√≠veis

```yaml
firestore:
  leitura: "‚úÖ COMPLETO - Todas as collections"
  escrita: "‚úÖ COMPLETO - Criar/atualizar documentos"
  dele√ß√£o: "‚úÖ COMPLETO - Deletar dados"
  queries: "‚úÖ COMPLETO - Queries complexas"

firebase_auth:
  listar: "‚úÖ Todos os usu√°rios"
  criar: "‚úÖ Novos usu√°rios"
  gerenciar: "‚úÖ Contas e permiss√µes"

firebase_storage:
  listar: "‚úÖ Arquivos e pastas"
  upload: "‚úÖ Imagens e arquivos"
  deletar: "‚úÖ Remover arquivos"

firebase_functions:
  deploy: "‚úÖ Novas functions"
  executar: "‚úÖ Chamar functions"
  logs: "‚úÖ Ver logs"

credenciais:
  arquivo: "futebadosparcas-firebase-adminsdk-fbsvc-b5fb25775d.json"
  projeto: "futebadosparcas"
  permiss√µes: "FULL ADMIN ACCESS"
```

### ‚ö†Ô∏è Diretrizes de Uso

```yaml
use_firebase_direto:
  - "Analisar estrutura de dados"
  - "Verificar dados antes de implementar"
  - "Debugar problemas de dados"
  - "Validar queries complexas"
  - "Criar dados de teste"

SEMPRE_confirme_antes:
  - "‚ùå DELETAR dados em produ√ß√£o"
  - "‚ùå Modificar dados de usu√°rios reais"
  - "‚ùå Alterar estrutura de collections"
  - "‚ùå Opera√ß√µes em massa"

prefira_app_android:
  - "Criar dados mock (Developer Menu)"
  - "Resetar base (Developer Menu)"
  - "Testar fluxos completos"
```

---

## üåê Idioma Obrigat√≥rio

```yaml
coment√°rios: portugu√™s (PT-BR)
strings_ui: portugu√™s (PT-BR)
c√≥digo: english
documenta√ß√£o: portugu√™s (PT-BR)
commits: portugu√™s (PT-BR)
```

## üìè Padr√µes de C√≥digo

### Arquitetura Obrigat√≥ria

```
MVVM + Clean Architecture + Hilt DI

UI Layer:
  - Fragment/Activity (ViewBinding ou Compose)
  - Observa StateFlow do ViewModel
  - NUNCA l√≥gica de neg√≥cio na UI

ViewModel Layer:
  - @HiltViewModel
  - StateFlow<UiState> (sealed classes)
  - viewModelScope para coroutines
  - NUNCA refer√™ncias a Context/Activity/Fragment

Repository Layer:
  - Interface + Implementa√ß√£o
  - Result<T> para opera√ß√µes que podem falhar
  - Flow<T> para dados em tempo real
  - suspend fun para opera√ß√µes √∫nicas

Data Source:
  - Firebase (Firestore, Auth, Storage, FCM)
  - Room (cache local)
```

### Null Safety

```kotlin
# PERMITIDO
?.let { }
?.run { }
?: defaultValue
if (x != null) { }

# PROIBIDO
!! operator (exceto em casos 100% seguros como binding)
```

### Coroutines

```kotlin
# ViewModel
viewModelScope.launch { }

# Fragment
viewLifecycleOwner.lifecycleScope.launch { }

# Repository (j√° √© suspend)
suspend fun getData(): Result<Data>
```

### StateFlow Pattern

```kotlin
# SEMPRE use este padr√£o:

sealed class MyUiState {
    object Loading : MyUiState()
    data class Success(val data: Data) : MyUiState()
    data class Error(val message: String) : MyUiState()
}

private val _uiState = MutableStateFlow<MyUiState>(MyUiState.Loading)
val uiState: StateFlow<MyUiState> = _uiState.asStateFlow()
```

## üîß Regras de Edi√ß√£o de Arquivos

### CR√çTICO - Estrat√©gia de Edi√ß√£o

```yaml
arquivos_xml:
  estrat√©gia: REWRITE COMPLETO
  raz√£o: "Indenta√ß√£o complexa causa falhas em patches"

arquivos_kotlin_grandes:
  estrat√©gia: REWRITE COMPLETO
  limite: "> 200 linhas"

arquivos_kotlin_pequenos:
  estrat√©gia: "EDIT pontual OK"
  limite: "< 200 linhas"

regra_de_ouro: |
  Se EDIT falhar 2 vezes, use WRITE para reescrever o arquivo completo
```

### Naming Conventions

```yaml
activities: "LoginActivity.kt"
fragments: "GamesFragment.kt"
viewmodels: "GamesViewModel.kt"
repositories: "GameRepository.kt" (interface)
              "GameRepositoryImpl.kt" (implementa√ß√£o)
adapters: "GamesAdapter.kt"
models: "Game.kt", "User.kt"
enums: "GameStatus.kt", "UserRole.kt"

layouts:
  activities: "activity_login.xml"
  fragments: "fragment_games.xml"
  items: "item_game.xml"
  dialogs: "dialog_select_position.xml"
```

## üî• Firebase Rules

### Collections Schema

```yaml
users:
  campos_obrigat√≥rios: [id, name, email, role]
  roles: [Player, FieldOwner, Admin]

games:
  campos_obrigat√≥rios: [id, locationId, dateTime, status, maxPlayers]
  status: [SCHEDULED, CONFIRMED, LIVE, FINISHED, CANCELLED]
  subcollections: [confirmations]

confirmations:
  campos_obrigat√≥rios: [userId, userName, position, confirmedAt]
  position: [GOALKEEPER, LINE_PLAYER]

locations:
  campos_obrigat√≥rios: [id, name, address, latitude, longitude]
  subcollections: [fields]

fields:
  campos_obrigat√≥rios: [id, name, type, locationId]
  types: [SOCIETY, FUTSAL, FIELD, BEACH, SYNTHETIC_GRASS]

statistics:
  campos_obrigat√≥rios: [userId, totalGames, wins, goals, assists]

live_games:
  campos_obrigat√≥rios: [id, gameId, type, playerId, teamNumber, timestamp]
  types: [GOAL, YELLOW_CARD, RED_CARD, SUBSTITUTION]
```

### Regras de Seguran√ßa

```yaml
autentica√ß√£o: OBRIGAT√ìRIA (exceto para mocks com isMock: true)

permiss√µes:
  leitura: "Autenticado"
  escrita_user: "Pr√≥prio usu√°rio ou Admin"
  escrita_game: "Criador do jogo ou Admin"
  escrita_admin: "Apenas Admin"

valida√ß√µes:
  roles: "Validar enums no Firestore rules"
  status: "Validar transi√ß√µes de estado"
  campos_obrigat√≥rios: "Validar presen√ßa"
```

## üì¶ Hilt Dependency Injection

### Modules Existentes

```yaml
AppModule:
  provides: [Repositories, UseCases]

FirebaseModule:
  provides: [FirebaseAuth, FirebaseFirestore, FirebaseStorage, FirebaseFunctions]

DatabaseModule:
  provides: [Room Database, DAOs]
```

### Anota√ß√µes Obrigat√≥rias

```kotlin
# ViewModel
@HiltViewModel
class MyViewModel @Inject constructor()

# Fragment/Activity
@AndroidEntryPoint
class MyFragment : Fragment()

# Repository no Module
@Provides
@Singleton
fun provideRepository(): Repository = RepositoryImpl()
```

## üé® Design System

```yaml
cores_prim√°rias:
  primary: "#58CC02"  # Verde Duolingo
  accent: "#FF9600"   # Laranja

cores_estado:
  success: "#58CC02"
  error: "#D32F2F"
  warning: "#FFA000"
  info: "#1976D2"

tipografia:
  fonte_principal: "Roboto"
  tamanhos: [12sp, 14sp, 16sp, 18sp, 24sp, 32sp]

espa√ßamento:
  unidade_base: 8dp
  valores: [4dp, 8dp, 16dp, 24dp, 32dp]

componentes:
  estilo: "Material Design 3"
  tema: "Gamificado (estilo Duolingo)"
```

## üö´ Proibi√ß√µes Absolutas

```yaml
proibido:
  - "findViewById() - Use ViewBinding"
  - "LiveData - Use StateFlow"
  - "!! operator (exceto binding)"
  - "Inje√ß√£o manual de depend√™ncias - Use Hilt"
  - "L√≥gica de neg√≥cio na UI"
  - "Hardcoded strings - Use strings.xml"
  - "Magic numbers - Use constants"
  - "God classes (> 500 linhas)"
  - "Nested callbacks - Use coroutines"
  - "Mutable collections expostas - Use toList()/toMap()"
```

## ‚úÖ Obriga√ß√µes

```yaml
obrigat√≥rio:
  - "ViewBinding ou Compose para UI"
  - "StateFlow para estado de UI"
  - "Hilt para DI"
  - "Coroutines para async"
  - "Result<T> para opera√ß√µes que podem falhar"
  - "Flow<T> para dados em tempo real"
  - "Sealed classes para UI states"
  - "Coment√°rios em portugu√™s"
  - "Try-catch em opera√ß√µes de rede/disco"
  - "Limpar binding em onDestroyView"
```

## üìä Status do Projeto (Refer√™ncia R√°pida)

```yaml
features_completas:
  autentica√ß√£o: 100%
  jogos: 95%
  locais: 90%
  estat√≠sticas: 85%
  jogo_ao_vivo: 80%

features_parciais:
  gamifica√ß√£o: 30%  # PRIORIDADE - Falta ViewModels
  pagamentos: 10%
  experi√™ncia_jogo: 15%

features_n√£o_iniciadas:
  schedules_recorrentes: 0%
  networking_convites: 0%
  backend_nodejs: 5%
```

## üéØ Prioridades de Desenvolvimento

```yaml
1_urgente:
  - "Completar gamifica√ß√£o (LeagueViewModel, BadgesViewModel)"
  - "Auto-award de badges ap√≥s jogos"

2_importante:
  - "Edi√ß√£o e cancelamento de jogos"
  - "Notifica√ß√µes FCM para confirma√ß√µes"

3_desej√°vel:
  - "Sistema de pagamentos PIX"
  - "Vota√ß√£o MVP"
  - "Cards instagram√°veis"
```

## üìÅ Estrutura de Arquivos

```yaml
models: "data/model/*.kt"
repositories: "data/repository/*Repository*.kt"
viewmodels: "ui/[feature]/*ViewModel.kt"
fragments: "ui/[feature]/*Fragment.kt"
activities: "ui/[feature]/*Activity.kt"
adapters: "ui/[feature]/*Adapter.kt"
layouts: "res/layout/*.xml"
drawables: "res/drawable/*.xml"
strings: "res/values/strings.xml"
colors: "res/values/colors.xml"
```

## üîç Documenta√ß√£o de Refer√™ncia

```yaml
contexto_geral: ".agent/QUICK_REFERENCE.md"
estado_projeto: ".agent/PROJECT_STATE.md"
padr√µes_firebase: ".agent/FIREBASE_MODERNIZATION.md"
features_pendentes: "IMPLEMENTACAO.md"
setup_projeto: "README.md"

instru√ß√µes_claude: "CLAUDE.md"
instru√ß√µes_gemini: "GEMINI.md"
contexto_gemini: ".agent/GEMINI_CONTEXT.md"
```

## üß™ Testing

```yaml
testes_unit√°rios:
  pasta: "test/"
  framework: "JUnit 4"
  mocking: "Mockito"

testes_instrumentados:
  pasta: "androidTest/"
  framework: "Espresso"

conven√ß√£o:
  nome: "[ClasseTestada]Test.kt"
  exemplo: "GameRepositoryImplTest.kt"
```

## üöÄ Release Protocol (CR√çTICO)

Sempre que o usu√°rio mencionar "publicar", "release", "loja", "play store", "produ√ß√£o" ou "nova vers√£o":

1. **Verificar `app/build.gradle.kts`**:
   - `versionCode`: Incrementar (+1) obrigat√≥rio
   - `versionName`: Semantic Versioning (Major.Minor.Patch)

2. **A√ß√£o Obrigat√≥ria**:
   - Atualizar `versionCode` e `versionName` antes de qualquer build de release.
   - Perguntar: "Confirmar vers√£o X (build Y)?" se houver d√∫vida.

3. **NUNCA gerar APK/AAB de release com vers√£o repetida.**

## üöÄ Build & Deploy

```bash
# Build debug
./gradlew assembleDebug

# Build release
./gradlew assembleRelease

# Instalar no device
./gradlew installDebug

# Testes
./gradlew test

# Clean
./gradlew clean
```

## üìù Commits

```yaml
formato: "tipo(escopo): mensagem em portugu√™s"

tipos:
  - feat: "Nova feature"
  - fix: "Corre√ß√£o de bug"
  - refactor: "Refatora√ß√£o"
  - style: "Formata√ß√£o, lint"
  - docs: "Documenta√ß√£o"
  - test: "Testes"
  - chore: "Manuten√ß√£o"

exemplos:
  - "feat(games): adicionar filtro de jogos abertos"
  - "fix(auth): corrigir valida√ß√£o de email"
  - "refactor(statistics): simplificar c√°lculo de m√©dia"
```

## üîí Seguran√ßa

```yaml
nunca_commitar:
  - google-services.json (usar .gitignore)
  - serviceAccountKey.json
  - .env
  - *.keystore
  - *.jks
  - Senhas ou tokens

sempre_validar:
  - Input do usu√°rio
  - Dados de APIs externas
  - Permiss√µes de roles
  - Transi√ß√µes de estado
```

## üìà Performance

```yaml
otimiza√ß√µes:
  - "Usar LazyColumn/LazyRow no Compose"
  - "Usar RecyclerView com DiffUtil"
  - "Paginar listas grandes"
  - "Cache com Room para offline"
  - "√çndices compostos no Firestore"
  - "Limitar queries Firestore"

evitar:
  - "Opera√ß√µes pesadas na UI thread"
  - "Queries N+1"
  - "Carregar todas as imagens de uma vez"
  - "Nested RecyclerViews"
```

## ü§ñ Especifica√ß√µes dos Modelos AI

Este projeto suporta m√∫ltiplos modelos AI. Escolha o modelo correto para cada tarefa.

### Claude (Anthropic)

```yaml
opus-4.5:
  arquivo: "OPUS.md"
  contexto: "200K tokens"
  velocidade: "Lenta"
  custo: "Muito alto ($$$$$)"
  uso: "Decis√µes arquiteturais cr√≠ticas, security audits, design de sistemas"
  quando_usar:
    - "Decis√£o afeta arquitetura do app"
    - "Trade-offs complexos (m√∫ltiplas solu√ß√µes v√°lidas)"
    - "Security audit cr√≠tico"
    - "Refatora√ß√£o arquitetural (>500 linhas)"
    - "ADRs (Architecture Decision Records)"
  quando_N√ÉO_usar:
    - "Implementa√ß√£o de c√≥digo"
    - "Corre√ß√µes triviais"
    - "Tasks bem definidas"

sonnet-4.5:
  arquivo: "CLAUDE.md"
  contexto: "200K tokens"
  velocidade: "R√°pida"
  custo: "M√©dio ($$) - 20% do Opus"
  uso: "Desenvolvimento di√°rio, implementa√ß√£o de features, debugging"
  quando_usar:
    - "Implementar ViewModels, Repositories, Fragments"
    - "Debugging de bugs conhecidos"
    - "Code reviews (<500 linhas)"
    - "Refatora√ß√µes locais (<300 linhas)"
    - "Testes unit√°rios"
  quando_N√ÉO_usar:
    - "Decis√µes arquiteturais (use Opus)"
    - "Tarefas triviais (use Gemini Flash)"
    - "An√°lise visual (use Gemini Pro)"
```

### Gemini (Google)

```yaml
gemini-3-pro-high:
  arquivo: "GEMINI.md"
  contexto: "10M tokens"
  velocidade: "Lenta"
  custo: "Alto ($$$$)"
  uso: "An√°lise profunda, multimodal, code execution"
  quando_usar:
    - "Refatora√ß√£o arquitetural complexa"
    - "An√°lise de seguran√ßa detalhada"
    - "Design de features novas e complexas"
    - "Code review profundo (>500 linhas)"
    - "Deep research mode"
  capacidades_√∫nicas:
    - "Multimodal (screenshots, diagramas)"
    - "Code execution (Python)"
    - "Contexto 10M tokens"

gemini-3-pro:
  arquivo: "GEMINI.md"
  contexto: "2M tokens"
  velocidade: "M√©dia"
  custo: "M√©dio ($$$)"
  uso: "Desenvolvimento geral, an√°lise visual"
  quando_usar:
    - "Implementa√ß√£o de features"
    - "Debugging com screenshots"
    - "An√°lise visual de UI"
    - "Valida√ß√£o de diagramas"
    - "An√°lise de dados via Python"
  capacidades_√∫nicas:
    - "Multimodal (screenshots, diagramas)"
    - "Code execution (Python)"

gemini-3-flash:
  arquivo: "GEMINI.md"
  contexto: "1M tokens"
  velocidade: "Muito r√°pida"
  custo: "Baixo ($)"
  uso: "Tarefas r√°pidas e simples"
  quando_usar:
    - "Corre√ß√µes simples (<10 linhas)"
    - "Consultas r√°pidas de c√≥digo"
    - "Renomea√ß√£o de vari√°veis"
    - "Ajustes de UI (cores, padding)"
  quando_N√ÉO_usar:
    - "Decis√µes arquiteturais"
    - "C√≥digo complexo"
    - "Refatora√ß√µes"
```

### Guia de Sele√ß√£o R√°pida

```yaml
decis√£o_arquitetural: "Opus 4.5"
design_sistema_complexo: "Opus 4.5 ou Gemini 3 Pro High"
security_audit: "Opus 4.5"
implementar_feature: "Sonnet 4.5"
debugging: "Sonnet 4.5"
code_review_pequeno: "Sonnet 4.5"
code_review_grande: "Opus 4.5"
an√°lise_visual: "Gemini 3 Pro"
corre√ß√£o_simples: "Gemini 3 Flash"
consulta_r√°pida: "Gemini 3 Flash"
```

### Workflow Recomendado

```
1. Decis√£o Arquitetural (Opus 4.5)
   ‚Üì
2. Implementa√ß√£o (Sonnet 4.5)
   ‚Üì
3. Valida√ß√£o Visual (Gemini 3 Pro)
   ‚Üì
4. Corre√ß√µes (Gemini 3 Flash ou Sonnet)
```

**Ver detalhes**: `.agent/MODEL_SELECTION.md`

---

## üéì Boas Pr√°ticas Finais

1. **Leia c√≥digo existente antes de criar novo**
2. **Siga os padr√µes do projeto religiosamente**
3. **Use os arquivos de refer√™ncia** (.agent/QUICK_REFERENCE.md)
4. **Escolha o modelo correto** (.agent/MODEL_SELECTION.md)
5. **Pergunte antes de fazer mudan√ßas arquiteturais**
6. **Teste localmente antes de commitar**
7. **Documente decis√µes importantes**
8. **Mantenha simplicidade** (KISS principle)
9. **N√£o reinvente a roda** (use bibliotecas consolidadas)
10. **Escale para Opus quando necess√°rio** (decis√µes cr√≠ticas)

---

**√öltima atualiza√ß√£o**: 27/12/2024
**Vers√£o**: 2.0 (Multi-Model Support)
